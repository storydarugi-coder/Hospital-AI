/**
 * 사람같은 글쓰기 프롬프트
 * AI 냄새를 제거하고 자연스러운 글쓰기 유도
 */

/**
 * 기본 사람같은 글쓰기 규칙
 */
export const HUMAN_WRITING_RULES = `
[AI 티 제거 규칙]
❌ 피해야 할 표현:
- "~에 대해 알아보겠습니다"
- "~라고 할 수 있습니다"
- "~것으로 나타났습니다"
- "~으로 볼 수 있습니다", "~이해할 수 있습니다", "~도움이 됩니다" (AI·교재 말투!)
- "다양한", "효과적인", "중요한" 남발
- 과도한 이모지 🚫
- "여러분", "오늘은" 등 틀에 박힌 서두
- 동일 종결어미 3회 초과 (특히 ~입니다/~편입니다/~있습니다)
- 🚨 "~죠", "~요" 체 (반말 느낌 - 의료 콘텐츠에서 금지!)

❌ 추상적 단어 → ✅ 체감 표현:
- "불편감" → "아프다", "거슬린다", "찝찝하다"
- "영향" → "힘들다", "무겁다", "뻐근하다"
- "반응" → "욱신거리다", "쑤시다", "당기다"
- "증상이 나타난다" → "아침에 일어나면 ~하다"
- 사람들이 실제로 쓰는 말로!

❌ 번역투 표현 (AI 냄새 강함!):
- "요소/요인" → "이유", "원인", "계기"
- "~측면에서" → "~쪽에서 보면", "~부분을"
- "~관점에서" → "~입장에서", "~으로 보면"
- "~에 있어서" → "~에서", "~할 때"
- "발생하다" → "생기다", "나타나다", "일어나다"
- "제공하다" → "주다", "내주다", "알려주다"
- "포함하다" → "들어가다", "담기다"
- "시행하다" → "하다", "진행하다", "실시하다"
- 🚨🚨🚨 "양상/양태" → 완전 금지! "모습", "형태", "상태"로만 사용
- 🚨🚨🚨 "문제" → 완전 금지! "어려움", "불편함"으로 자연스럽게
- "측면" → "부분", "면", "쪽"
- 🚨🚨🚨 "연관성" → 완전 금지! "~하면 ~합니다", "~때 ~하더라고"
- 🚨🚨🚨 "관련이" → 완전 금지! "~이면 ~해집니다", "~할수록 ~합니다"
- 🚨🚨🚨 "영향을 미치다" → 완전 금지! "~때문에 ~합니다", "~하니까 ~하네"
- 🚨🚨🚨 "~로 인해/에 의해" → 완전 금지! "~하면", "~하니까"로 간결하게

✅ 자연스러운 표현:
- 짧은 문장과 긴 문장 자연스럽게 섞기 (단, 60자 초과 금지!)
- 핵심을 먼저, 부연설명은 나중에
- 감각 묘사 사용 (찌릿한, 묵직한, 뻣뻣한, 당기는)
- 전환어 활용 (신기하게도, 다행히, 다만, 하지만, 그런데)
- 비유는 글 전체에서 1~2개만! (과하면 산만함)
- 자연스러운 종결어미 다양화 (~겁니다, ~합니다, ~됩니다, ~습니다)
- 반말/존댓말 일관성 유지
- 번역투 대신 일상 언어 사용 (요소→이유, 발생→생기다)

✨ 문장 유려함 (뚝뚝 끊김 방지, 단 만연체 아님!):
━━━━━━━━━━━━━━━━━━
🎯 [핵심] 문장을 "연결"하되 "늘어지지 않게"
- ❌ 짧게만 끊기: "무릎이 아픕니다. 계단 오를 때 더 심합니다. 날씨가 추우면 악화됩니다." (로봇 느낌)
- ❌ 길게만 늘이기: "무릎이 아프고, 계단 오를 때 더 심하며, 날씨가 추우면 악화됩니다." (만연체)
- ✅ 자연스러운 연결: "무릎이 아플 때가 있습니다. 특히 계단 오를 때 더 심해지는데, 날씨가 추우면 더 불편합니다."

📐 문장 길이 가이드:
- 짧은 문장: 15~25자 (핵심 전달)
- 중간 문장: 30~40자 (부연 설명)
- 긴 문장: 45~55자 (맥락 연결, 60자 초과 ❌)
- 리듬: 짧음 → 중간 → 짧음 → 긴 문장 반복

🔗 문장 연결 기법 (유려함의 핵심):
1. **접속어 활용** (문장 사이 자연스러운 다리)
   - 인과: "그래서", "때문에", "덕분에"
   - 대조: "하지만", "다만", "그런데", "반면"
   - 부연: "게다가", "더욱이", "특히"
   - 전환: "한편", "다른 한편으로는"
   
2. **연결어미 활용** (한 문장 내 자연스러운 흐름)
   - ~는데/~지만: "무릎이 아픈데, 원인은 다양합니다"
   - ~어서/~아서: "날씨가 추워서 관절이 뻣뻣합니다"
   - ~면서: "걸으면서 무릎에서 소리가 납니다"
   - ~거나: "앉았다 일어나거나 계단 오를 때"
   
3. **관형절 활용** (명사 앞에서 자연스럽게 수식)
   - "아침에 일어날 때 느껴지는 뻣뻣함"
   - "오래 앉아있다 일어설 때 나타나는 통증"
   - "날씨가 추울 때 더 심해지는 불편함"

🚨 단, 만연체는 절대 금지!
- 한 문장에 접속사 2개까지만 (예: ~고, ~지만)
- 쉼표(,) 3개 이상 ❌
- 60자 초과 ❌

✅ 좋은 예시 (유려하되 만연체 아님):
"무릎이 시릴 때가 있습니다. 특히 아침에 일어나면 뻣뻣한 느낌이 드는데, 몇 분 움직이다 보면 조금씩 나아집니다. 하지만 계단을 오를 때는 여전히 불편합니다."
→ 짧음(25자) + 긴(50자) + 짧음(30자) = 자연스러운 리듬

❌ 나쁜 예시 (뚝뚝 끊김):
"무릎이 시릴 때가 있습니다. 아침에 일어나면 뻣뻣합니다. 움직이면 나아집니다. 계단 오를 때는 불편합니다."
→ 전부 짧은 문장 = 로봇 느낌

❌ 나쁜 예시 (만연체):
"무릎이 시리고, 아침에 일어나면 뻣뻣하며, 움직이면 나아지지만, 계단 오를 때는 불편합니다."
→ 접속사 4개 = 호흡 늘어짐

🚨🚨🚨 과도한 완곡 표현 금지 (AI 로봇 느낌!):
❌ "~도 괜찮은 시도입니다" → ✅ "~해봅니다" / "~해보면 좋습니다"
❌ "~한번쯤 짚어볼 만합니다" → ✅ "~살펴봅니다" / "~확인해봅니다"
❌ "~하나의 요령이 될 수 있습니다" → ✅ "~방법입니다" / "~도움이 됩니다"
❌ "~해보는 것도 방법입니다" → ✅ "~해봅니다" / "~하면 됩니다"
❌ "~하는 편입니다" (연속 사용 금지) → 문장마다 다른 종결어미 사용!
❌ "~할 수 있습니다" (연속 3회 이상 금지)

✅ 자연스러운 대안:
- "물건을 들 때 몸에 가까이 붙입니다" (단순 직설)
- "쿠션을 무릎 아래 받치면 허리가 편합니다" (짧고 명확)
- "다리 사이에 베개를 끼우면 골반이 수평이 됩니다" (구체적)

🎯 문장 리듬 다양화 (로봇 느낌 제거!):
- 한 문단 내에서 종결어미를 3가지 이상 변주!
- 예: "~합니다" → "~됩니다" → "~입니다" → "~느껴집니다"
- 짧은 문장(20자) + 중간 문장(40자) + 짧은 문장(25자) 리듬
- 같은 패턴 2회 이상 반복 금지!

❌ 나쁜 예 (로봇):
"~해봅니다. ~해봅니다. ~해봅니다."

✅ 좋은 예 (자연스러움):
"~해봅니다. ~편합니다. 다만, ~합니다."

🚨 만연체 금지 (호흡 늘어짐 방지):
- 한 문장 40자 이내 권장, 60자 초과 ❌
- 쉼표(,) 3개 이상 → 문장 나누기!
- "~하고, ~하며, ~해서" 이어붙이기 금지

🔄 중복 내용 금지:
- 도입부에서 한 말을 본문에서 반복 ❌
- 같은 내용을 다른 표현으로 돌려쓰기 ❌
- 각 소제목은 서로 다른 관점/정보 제공!
- "이거 아까 읽은 것 같은데?" 느낌 ❌

📐 구조 가이드:
- 도입: 일상에서 겪을 법한 상황으로 시작
- 증상: 체감 위주로 (의학 용어보다 느낌 묘사)
- 원인: 한 박자 쉬듯 짧게 덧붙이기 (길게 설명 ❌)
- 관리: '선택지'처럼 제시 (훈계·명령 ❌)
- 결론: 판단을 독자에게 맡기기 (단정 ❌)
`;

/**
 * 톤별 사람같은 글쓰기 프롬프트
 * ⚠️ 주의: 질문형(?), 출처, 기관명 모두 금지!
 */
export const HUMAN_TONE_PROMPTS = {
  empathy: `
공감형 글쓰기:
- 3인칭 관찰자 시점으로 독자 상황 묘사
- 증상→공감→정보 순서
- ⚠️ 질문형(?) 금지! 서술형으로 공감 유도
❌ "이런 경험 있으시죠?" / "무릎이 아프신가요?"
✅ "무릎이 아플 때마다 계단이 두려워지는 분들이 있습니다."
✅ "아침에 일어나면 허리가 뻣뻣한 경우가 있습니다."
`,

  professional: `
신뢰형 글쓰기:
- 의학 용어는 ( ) 안에 쉬운 설명 추가
- ⚠️ 출처/기관명/수치 금지! "일반적으로 알려져 있습니다"로 대체
- 단정적 표현 피하기
❌ "(출처: 건강보험심사평가원)" / "50대 이상에서 30%"
✅ "퇴행성관절염(연골이 닳아 생기는 질환)은 중년층에서 흔히 나타나는 편입니다."
`,

  simple: `
쉬운 글쓰기:
- 전문용어 → 쉬운 말
- 한 문장에 한 가지 내용
- 능동태 우선
- 🚨 만연체 금지: 한 문장에 접속사 2개 이상 금지 (~고, ~며, ~지만)
- 🚨 문장 길이: 최대 50자 권장 (공백 포함)
예: "약을 먹으면" (O) vs "약을 복용하시면" (X)
❌ "약을 먹고, 충분히 쉬며, 물을 많이 마시면 나아집니다" (만연체)
✅ "약을 먹으면 도움이 됩니다. 충분히 쉬는 것도 중요합니다." (분리)
`,

  informative: `
정보형 글쓰기:
- 핵심 먼저, 부연 나중
- 자연스러운 문단 흐름 (번호 매기기 자제)
- "왜 그런지"에 대한 설명 포함
- 🚨 내용 중복 금지: 같은 메시지를 다른 표현으로 반복하지 말 것
- 🚨 각 문단은 새로운 정보 제공
❌ "1. 혈압약은 아침에 먹습니다."
✅ "혈압약은 아침에 먹는 편이 좋습니다. 혈압이 오전에 높아지는 경향이 있기 때문입니다."
❌ "혈당이 오르면 피로합니다. 혈당 변화로 몸이 무겁습니다." (중복!)
✅ "혈당이 오르면 피로합니다. 지속되면 집중력도 떨어집니다." (진행)
`
};

/**
 * 의료광고법 준수 핵심 규칙 (간결 버전)
 * ⚠️ 실시간 의료광고법 정보는 loadMedicalLawForGeneration()에서 자동 로드됩니다.
 * 여기는 AI 냄새 제거 + 자연스러운 표현에 집중!
 */
export const MEDICAL_LAW_HUMAN_PROMPT = `
[의료광고법 + 자연스러운 표현 핵심]

🚨 절대 금지 (P1 - 즉시 탈락)
━━━━━━━━━━━━━━━━━━
• 공포 조장: "위험", "독성", "출혈", "방치하면 악화"
• 효과 보장: "완치", "100%", "반드시 낫습니다"
• 행동 유도: "~하세요", "~해야 합니다", "상담하세요", "고려해야", "고려하는 것"
• 광고성 단어: "해결", "해결책", "효과", "방법", "지름길"
• 숫자 사용: "2주", "48시간", "30%" 등 모든 수치
• 출처/기관명: "건강보험심사평가원", "대한의학회" 등
• 전문성 강조: "전문가", "전문의", "명의", "의료진"
• 진단 표현: "진단", "판단", "의심"
• 🚨 번역투 금지: "연관성", "관련이", "영향을 미치다", "발생하다", "양상", "문제", "고려" (완전 금지!)

🚨 광고성 오인 패턴 완전 금지 (신규 강화)
━━━━━━━━━━━━━━━━━━
1. **질환명 반복 + 증상 나열 구조 금지**
   ❌ "척추측만증은 허리 통증, 어깨 불균형을 유발합니다. 척추측만증이 심해지면..."
   ✅ "허리 불편함이나 자세 변화를 느낄 수 있습니다"
   → 질환명을 반복하며 증상을 나열하면 광고로 오인

2. **단정적 인과 구조(원인→결과) 절대 금지**
   ❌ "잘못된 자세가 척추를 틀어지게 만들고, 이것이 통증을 유발합니다"
   ❌ "스트레스 → 근육 긴장 → 두통 발생"
   ✅ "여러 요인 중 하나로 알려져 있습니다"
   ✅ "~하면 ~해질 수 있다고 합니다"
   → 원인-결과를 단정하면 의료 판단으로 오인

3. **'여러 원인 중 하나'로만 표현 (필수)**
   ❌ "장시간 스마트폰 사용이 거북목의 주요 원인입니다"
   ✅ "장시간 같은 자세가 여러 원인 중 하나로 언급되기도 합니다"
   → 특정 원인을 강조하지 말고 다양한 가능성 중 하나로만 제시

4. **'불안 유발 → 확인 유도 → 행동 촉구' 3단 구조 절대 금지**
   ❌ "이런 증상이 있다면 위험할 수 있습니다. 정확한 확인이 필요합니다. 병원을 방문해보세요"
   ✅ "경우에 따라 상황이 다를 수 있습니다"
   → 불안→확인→행동유도 순서로 유도하면 광고로 판단

✅ 안전한 대체 표현 (자연스러운 한국어)
━━━━━━━━━━━━━━━━━━
• "~할 수 있습니다" / "~는 편입니다" (단, 과도하게 사용 금지!)
• "~하는 경우가 있습니다" / "~다고 합니다"
• "~하면 ~합니다" / "~이면 ~해집니다" (인과관계 자연스럽게)
• "~로 보입니다" / "~일 가능성도 있습니다"
• "살펴보는 것도 방법입니다" / "점검해보는 경우가 있습니다"

🚨 과도한 완곡 표현 금지 (AI 로봇 문체 제거!)
━━━━━━━━━━━━━━━━━━
❌ "~도 괜찮은 시도입니다" → ✅ "~해봅니다"
❌ "~한번쯤 짚어볼 만합니다" → ✅ "~살펴봅니다"
❌ "~하나의 요령이 될 수 있습니다" → ✅ "~방법입니다"
❌ 같은 종결어미 3회 연속 사용 → ✅ 매 문장 다른 어미로 변주!

예시:
❌ "무게 중심을 가까이 두는 습관도 괜찮은 시도입니다. 잠자리 자세도 한번쯤 짚어볼 만합니다."
✅ "무게 중심을 몸 가까이 둡니다. 잠잘 때 자세도 살펴봅니다."

🎯 핵심: 관찰·서술 중심, 독자가 스스로 판단하도록 유도
`;


/**
 * 🖼️ 이미지 텍스트용 의료광고법 규칙 (통합)
 * 이미지 안에 렌더링되는 텍스트에도 적용!
 */
export const IMAGE_TEXT_MEDICAL_LAW = `[이미지 텍스트 의료광고법 규칙]
🚨 절대 금지 (이미지 텍스트에서도 위반!)
━━━━━━━━━━━━━━━━━━
- "완치", "치료 효과", "100% 안전"
- "조기 발견", "조기 치료" (불안 조장)
- "~하세요", "~해야 한다", "상담하세요", "방문하세요" (행동 유도)
- "2주 이상", "48시간 내" 등 구체적 시간
- 출처, 기관명, 수치 (%, 명, 건)
- "전문가/전문의/명의" 등

✅ 허용되는 표현:
- 증상명, 질환명 (사실 정보)
- 질문형 제목 ("무릎이 시린 이유는?")
- 정보 전달 ("관절염의 특징")
- "~일 수 있어요", "~인 경우가 있습니다" (가능성 표현)
`;

/**
 * 네이버 스마트블록 최적화 + 문단 구조 가이드
 * 🎯 목표: 검색 상위노출 + 모바일 가독성
 */
export const PARAGRAPH_STRUCTURE_GUIDE = `
[🎯 네이버 스마트블록 최적화 - 상위노출 핵심]
━━━━━━━━━━━━━━━━━━

🥇 첫 200자 황금 구간 (검색 상위노출 결정!)
━━━━━━━━━━━━━━━━━━
- 네이버가 이 구간을 검색 결과 미리보기(스니펫)로 사용!
- 핵심 키워드를 첫 문장~50자 안에 자연스럽게 1회 배치
- 첫 문장에서 바로 "무슨 글인지" + "누구를 위한 글인지" 명확하게
- 첫 200자 안에 핵심 키워드 1~2회 + 관련어 1회

🥇 첫 문장 황금 공식 (검색 클릭률 결정!):
✅ [증상/상황] + [대상] + [키워드] 조합
✅ "아침마다 손가락이 뻣뻣하게 굳는 느낌, 류마티스 관절염의 초기 신호일 수 있습니다."
✅ "오래 앉아있다 일어서면 허리가 뻐근한 분들이 있습니다."
✅ "밤에 자다가 다리에 쥐가 나서 깨는 경우가 있습니다."
❌ "오늘은 관절염에 대해 알아보겠습니다." (메타 설명 = 즉시 탈락)
❌ "관절염은 많은 사람들이 겪는 질환입니다." (키워드 늦게, 뻔한 서두)

📱 모바일 가독성 (트래픽의 80%가 모바일!)
━━━━━━━━━━━━━━━━━━
- 한 문단 3~4줄 이내 (모바일에서 한 화면에 보이게)
- 문장 길이 40자 내외 권장, 60자 초과 금지!
- 소제목(h3) 사이에 이미지 배치 → 시각적 휴식 + 스크롤 유도
- 줄바꿈 적극 활용 (빽빽한 텍스트 = 이탈률 증가)

🚨 내용 중복 금지 (필수!)
━━━━━━━━━━━━━━━━━━
- 같은 메시지를 다른 표현으로 반복하지 말 것
- 각 문단은 새로운 정보를 제공해야 함
- "즉", "다시 말해" 같은 반복 연결어 사용 금지
❌ "혈당이 오르면 피로합니다. 혈당 변화로 몸이 무겁습니다." (중복!)
✅ "혈당이 오르면 피로합니다. 지속되면 집중력도 떨어집니다." (진행)

🚨 만연체 문장 금지 (필수!)
━━━━━━━━━━━━━━━━━━
- 한 문장에 접속사 2개 이상 금지 (~고, ~며, ~지만)
- 하나의 문장 = 하나의 핵심 메시지
❌ "무릎이 아프고, 계단 오를 때 더 심하며, 날씨가 추우면 악화됩니다" (만연체)
✅ "무릎이 아픕니다. 계단 오를 때 더 심합니다. 날씨가 추우면 악화됩니다." (명확)

📝 소제목 배치 전략 (C-Rank/DIA 영향)
━━━━━━━━━━━━━━━━━━
- 4~6개 권장, 300~400자마다 1개
- 생활 장면형 소제목 필수 (검색 의도와 일치)

🎯 소제목 황금 공식:
✅ [시간] + [상황] + [증상]: "아침에 일어나면 손이 뻣뻣할 때"
✅ [장소] + [상황]: "오래 앉아있다 일어설 때", "계단 내려갈 때"
✅ [동작] + [증상]: "걸을 때 무릎에서 소리가 나면"
✅ [상황] + [시점]: "밤에 자다가 다리에 쥐가 날 때"

❌ 금지 소제목 (AI 느낌, 검색 의도 불일치):
❌ "관절염의 원인" / "증상의 특징" (설명형)
❌ "다양한 신호들" / "여러 증상" (추상적)
❌ "~이란?" / "~알아보기" (메타형)

🔑 키워드 밀도
━━━━━━━━━━━━━━━━━━
- 핵심 키워드: 전체 글에서 5~8회 자연스럽게
- 같은 문장에 2회 이상 ❌ (키워드 스터핑 = 저품질)
- 유사어/관련어 함께 사용 (자연스러운 변주)
- 첫 200자, 첫 소제목, 마지막 문단에 키워드 필수 배치

🖼️ 이미지+텍스트 교차 배치
━━━━━━━━━━━━━━━━━━
- 소제목 → 이미지 → 본문 2~3문단 → 다음 소제목
- 이미지 alt 텍스트에도 키워드 포함
- 이미지 사이즈: 가로 전체 폭 권장 (모바일 최적화)

[자연스러운 문단 구조]
━━━━━━━━━━━━━━━━━━
서두 (1-2문장):
- 생생한 증상/상황 묘사로 시작 (3인칭)
- ⚠️ 질문형(?) 금지!
❌ "허리 통증이 3개월 이상 지속된다면?"
✅ "허리 통증이 몇 달째 이어지는 분들이 있습니다."

본문 (3-5문장):
- 짧은 문장 → 긴 문장 → 짧은 문장 리듬
- 핵심 정보 → 부연 설명 순서
- ⚠️ 통계/수치/출처 금지! → "일반적으로", "흔히" 사용

마무리 (1-2문장):
- 정보 요약으로 마무리 (행동 유도 금지!)
- ⚠️ "병원 방문", "상담하세요" 등 CTA 금지!
- 🎯 **독자 판단 존중**: 단정하지 말고 선택권을 독자에게
- ❌ "반드시 병원에 가세요" / "지금 바로 확인하세요"
- ✅ "이런 증상이 반복된다면 몸이 보내는 신호일 수 있습니다"
- ✅ "증상이 길어진다면 살펴보는 것도 방법입니다"

🎯 [글의 목적: 병원 홍보 ❌ / 정보 제공 ✅]
━━━━━━━━━━━━━━━━━━
- 병원 내원을 유도하는 표현 완전 금지
- 특정 병원/의료진 언급 금지
- 공감은 유지하되 감정 과잉 피하기
  - ❌ "정말 힘드시죠?" / "너무 고통스러우시죠?"
  - ✅ "불편한 경우가 있습니다" / "신경 쓰이는 분들이 있습니다"
- 정보 전달에 집중, 독자의 판단을 존중하는 마무리
`;

/**
 * Few-shot 예시 (좋은 글 vs 나쁜 글)
 */
export const FEW_SHOT_EXAMPLES = `
[나쁜 예시 - AI 티남]
당뇨병은 현대인에게 흔한 질병입니다. 당뇨병에 대해 자세히 알아보겠습니다.
다양한 증상이 나타날 수 있으며, 적절한 관리가 중요합니다.
혈당 관리가 필요합니다. 합병증 예방이 중요합니다. 정기 검진이 필요합니다.
→ 문제: 메타 설명, "다양한", 종결어미 반복, "중요합니다" 남발

[나쁜 예시 - 번역투 AI 냄새]
당뇨병의 요인은 다양한 측면에서 발생합니다. 유전적 요소가 포함되며, 생활습관 측면에서도 문제가 나타날 수 있습니다.
→ 문제: 요인, 측면, 발생, 포함, 양상 (번역투 과다!)

[나쁜 예시 - 의료광고법 위반]
2주 이상 증상이 지속되면 조기 발견이 중요합니다. 전문의와 상담하세요.
질병관리청에 따르면 30%가 이런 증상을 겪습니다.
→ 문제: 구체적 시간(2주), 조기 발견, 행동 유도(상담하세요), 기관명, 수치(30%)

[나쁜 예시 - 질문형 사용]
혹시 이런 증상 있으신가요? 무릎이 아프신 적 있나요?
→ 문제: 질문형(?), 독자에게 말 걸기

---
[좋은 예시 - 자연스러운 3인칭 서술]
아침에 일어나자마자 입안이 바짝 마르고, 목구멍이 타는 듯한 느낌이 드는 날이 있습니다.
신기하게도 물을 아무리 마셔도 갈증이 쉽게 가시지 않고, 한두 시간도 안 돼 화장실을 다시 찾게 됩니다.
이런 패턴이 며칠째 반복된다면, 혈당 조절 쪽에 변화가 생긴 건 아닌지 살펴볼 필요가 있습니다.
→ 좋은 점: 생생한 감각 묘사, 전환어(신기하게도), 3인칭 관찰자 시점

[좋은 예시 - 의료광고법 준수]
당뇨병은 완치보다는 꾸준한 관리가 필요한 편입니다.
식습관과 운동 습관을 조금씩 바꿔가면서 혈당 변화를 지켜보는 것도 방법입니다.
→ 좋은 점: 행동 유도 없음, 출처/기관명 없음, 부드러운 마무리

[번역투 개선 예시]
❌ "당뇨병 발생 요인은 다양한 측면에서 나타납니다"
✅ "당뇨병이 생기는 이유는 여러 가지입니다"

❌ "운동 측면에 있어서 중요한 요소는 규칙성입니다"
✅ "운동할 때 가장 중요한 건 규칙적으로 하는 겁니다"

❌ "당뇨병의 다양한 양상이 나타나는데 문제가 됩니다"
✅ "당뇨병으로 여러 증상이 생기면 불편할 수 있습니다"

❌ "스트레스는 불면증과 연관성이 있습니다"
✅ "스트레스 쌓이면 잠을 못 자더라고"
✅ "스트레스 받을수록 잠이 안 옵니다"

❌ "장시간 자세 유지는 목 통증과 관련이 있습니다"
✅ "오래 같은 자세로 있으면 목이 뻐근합니다"
✅ "계속 앉아 있으니까 목이 아프네"
`;

/**
 * 카테고리별 맞춤 프롬프트
 */
export const CATEGORY_SPECIFIC_PROMPTS = {
  internal_medicine: `내과: 증상→원인→관리 순서. 일상생활 팁 포함`,
  orthopedics: `정형외과: 통증 부위 구체적 묘사. 운동법 포함`,
  dermatology: `피부과: 시각적 묘사 자제. 생활습관 중심`,
  pediatrics: `소아과: 보호자 관점. 불안 해소 먼저`,
  psychiatry: `정신건강의학과: 낙인 제거. 일상 언어 사용`,
  ophthalmology: `안과: 증상 구체화. 예방법 강조`,
  dentistry: `치과: 통증 공감. 치료 과정 설명`,
  oriental_medicine: `한의원: 체질 언급 자제. 과학적 근거 제시`
};

/**
 * 프롬프트 생성 함수
 */
export function generateHumanWritingPrompt(
  category?: string,
  tone: keyof typeof HUMAN_TONE_PROMPTS = 'empathy'
): string {
  const tonePrompt = HUMAN_TONE_PROMPTS[tone];
  const categoryPrompt = category && category in CATEGORY_SPECIFIC_PROMPTS
    ? CATEGORY_SPECIFIC_PROMPTS[category as keyof typeof CATEGORY_SPECIFIC_PROMPTS]
    : '';

  return `
${HUMAN_WRITING_RULES}
${tonePrompt}
${MEDICAL_LAW_HUMAN_PROMPT}
${PARAGRAPH_STRUCTURE_GUIDE}
${categoryPrompt}

[참고 예시]
${FEW_SHOT_EXAMPLES}
`.trim();
}

/**
 * AI 냄새 감지 함수
 */
export function detectAiSmell(text: string): {
  detected: boolean;
  patterns: string[];
  score: number; // 0-100, 높을수록 AI 냄새 강함
} {
  const aiPatterns: Array<{ pattern: RegExp; name: string; maxAllowed?: number }> = [
    { pattern: /에\s*대해\s*알아보[겠습니다|자]/g, name: '~에 대해 알아보겠습니다' },
    { pattern: /라고\s*할\s*수\s*있습니다/g, name: '~라고 할 수 있습니다' },
    { pattern: /것으로\s*나타났습니다/g, name: '~것으로 나타났습니다' },
    { pattern: /으로\s*볼\s*수\s*있습니다/g, name: '~으로 볼 수 있습니다 (AI·교재 말투)' },
    { pattern: /이해할\s*수\s*있습니다/g, name: '~이해할 수 있습니다 (AI·교재 말투)' },
    { pattern: /도움이\s*될\s*수\s*있습니다/g, name: '~도움이 될 수 있습니다 (AI·교재 말투)', maxAllowed: 1 },
    { pattern: /죠(?![가-힣])|요(?=\s|$|\.)/g, name: '~죠/~요 체 (반말 느낌 - 의료 콘텐츠 금지!)', maxAllowed: 0 },
    { pattern: /불편감/g, name: '불편감 (추상어 - 체감어로 변경!)' },
    { pattern: /영향을\s*미치/g, name: '영향을 미치다 (추상어 - 체감어로 변경!)' },
    { pattern: /다양한/g, name: '다양한 (과다 사용)', maxAllowed: 2 },
    { pattern: /여러분/g, name: '여러분 (과다 사용)' },
    { pattern: /오늘은/g, name: '오늘은 (틀에 박힌 서두)' },
    { pattern: /입니다(?![가-힣])/g, name: '~입니다 (종결어미 반복)', maxAllowed: 3 },
    { pattern: /편입니다(?![가-힣])/g, name: '~편입니다 (종결어미 반복)', maxAllowed: 3 },
    { pattern: /있습니다(?![가-힣])/g, name: '~있습니다 (종결어미 반복)', maxAllowed: 3 },
    { pattern: /정리해보려\s*합니다/g, name: '~정리해보려 합니다 (메타 설명)' },
    { pattern: /살펴보[겠습니다|자]/g, name: '~살펴보겠습니다 (메타 설명)' },
    { pattern: /해보려\s*합니다/g, name: '~해보려 합니다 (메타 설명)' },
    { pattern: /도움이\s*될지.*정리/g, name: '도움이 될지 정리 (메타 설명)' },
    { pattern: /어떤\s*부분을\s*살펴보/g, name: '어떤 부분을 살펴보 (메타 설명)' },
    { pattern: /차근차근/g, name: '차근차근 (AI 특유 표현)' },
    { pattern: /전문가|전문의|명의|베테랑|숙련된|전문적|(?<![가-힣])전문(?![가-힣의])/g, name: '자격 강조 표현 금지 (전문가/전문의/명의/전문/전문적)' },
    
    // 🚨 번역투 표현 감지 (AI 냄새 강함!)
    { pattern: /요소|요인/g, name: '요소/요인 (번역투 - AI 냄새!)', maxAllowed: 1 },
    { pattern: /측면에서/g, name: '~측면에서 (번역투 - AI 냄새!)', maxAllowed: 0 },
    { pattern: /관점에서/g, name: '~관점에서 (번역투 - AI 냄새!)', maxAllowed: 0 },
    { pattern: /~에\s*있어서/g, name: '~에 있어서 (번역투 - AI 냄새!)', maxAllowed: 0 },
    { pattern: /측면|양상|양태/g, name: '측면/양상/양태 (번역투 논문체 - 완전 금지!)', maxAllowed: 0 },
    { pattern: /제공하다|제공됩니다/g, name: '제공하다 (번역투)', maxAllowed: 1 },
    { pattern: /발생하다|발생합니다/g, name: '발생하다 (번역투 - 생기다/나타나다로 변경)', maxAllowed: 2 },
    { pattern: /나타나다|나타납니다/g, name: '나타나다 (과다 사용 - 보이다/드러나다로 변경)', maxAllowed: 3 },
    { pattern: /포함하다|포함됩니다/g, name: '포함하다 (번역투 - 들어가다로 변경)', maxAllowed: 1 },
    { pattern: /시행하다|시행됩니다/g, name: '시행하다 (번역투 - 하다/진행하다로 변경)', maxAllowed: 0 },
    
    // 🚨 의료광고법 위반 표현 추가 (절대 금지!)
    { pattern: /의심/g, name: '의심 (의료광고법 위반 - 절대 금지!)', maxAllowed: 0 },
    { pattern: /판단/g, name: '판단 (의료광고법 위반 - 절대 금지!)', maxAllowed: 0 },
    { pattern: /진단/g, name: '진단 (의료광고법 위반 - 절대 금지!)', maxAllowed: 0 },
    { pattern: /가능성/g, name: '가능성 (의료광고법 위반 - 절대 금지!)', maxAllowed: 0 },
    { pattern: /환자(?!.*분)/g, name: '환자 (독자 중심 표현 사용 권장)', maxAllowed: 0 },
    { pattern: /내원/g, name: '내원 (독자 중심 표현 사용 권장)', maxAllowed: 0 },
    { pattern: /\([가-힣]+\d{4}\)/g, name: '기관명(연도) 형식 (절대 금지!)', maxAllowed: 0 },
    
    // 🚨 임신/출산 관련 키워드 조건부 금지
    // ⚠️ 사용자 입력에 임신/출산 키워드가 없으면 금지!
    // ✅ 사용자 입력에 임신/출산 키워드가 있으면 허용 (주제니까!)
    { pattern: /임신|출산|아기|태아|분만|산모/g, name: '임신/출산/아기 (사용자 요청 없으면 금지!)', maxAllowed: 0 },
    { pattern: /임신\s*(준비|계획|초기|중)/g, name: '임신 관련 표현 (사용자 요청 없으면 금지!)', maxAllowed: 0 },
    { pattern: /출산\s*계획|제왕절개|자연분만|산도/g, name: '출산 관련 표현 (사용자 요청 없으면 금지!)', maxAllowed: 0 },
    { pattern: /아이를\s*기다리|아기를\s*갖기\s*위해/g, name: '아기 관련 표현 (사용자 요청 없으면 금지!)', maxAllowed: 0 },
    { pattern: /태아에게\s*영향|엄마가\s*되기\s*위해/g, name: '태아/엄마 관련 표현 (사용자 요청 없으면 금지!)', maxAllowed: 0 },
    
    // 🚨 광고성 핵심 단어 금지 (피드백 반영)
    { pattern: /지름길/g, name: '지름길 (광고성 표현 - 금지!)', maxAllowed: 0 },
    { pattern: /방법(?!.*없)/g, name: '방법 (광고성 표현 - 금지!, "방법없다"는 허용)', maxAllowed: 0 },
    { pattern: /상담/g, name: '상담 (광고성 표현 - 금지!)', maxAllowed: 0 },
    { pattern: /효과(?!.*없)/g, name: '효과 (광고성 표현 - 금지!, "효과없다"는 허용)', maxAllowed: 0 },
    { pattern: /해결책/g, name: '해결책 (광고성 표현 - 금지!)', maxAllowed: 0 },
    { pattern: /해결(?!.*[안없])/g, name: '해결 (광고성 표현 - 금지!, "해결 안 됨/해결 없다"는 허용)', maxAllowed: 0 },
    
    // 🚨 자극적·공포 유발 단어 금지 (피드백2 반영)
    { pattern: /위험(?!.*없)/g, name: '위험 (공포 유발 - 금지!, "위험없다"는 허용)', maxAllowed: 0 },
    { pattern: /독성/g, name: '독성 (공포 유발 - 금지!)', maxAllowed: 0 },
    { pattern: /출혈/g, name: '출혈 (공포 유발 - 금지!)', maxAllowed: 0 },
    { pattern: /과부하/g, name: '과부하 (공포 유발 - 금지!)', maxAllowed: 0 },
    { pattern: /아찔한/g, name: '아찔한 (공포 유발 - 금지!)', maxAllowed: 0 },
    
    // 🚨 조언형·훈계형 문장 금지 (피드백2 반영)
    { pattern: /현명합니다|현명한\s*선택/g, name: '현명합니다/현명한 선택 (훈계형 - 금지!)', maxAllowed: 0 },
    { pattern: /어떨까요/g, name: '어떨까요 (조언형 - 금지!)', maxAllowed: 0 },
    { pattern: /하시는\s*게\s*좋/g, name: '~하시는 게 좋 (조언형 - 금지!)', maxAllowed: 0 },
    { pattern: /고려해야|고려하는\s*것|고려해보|고려합니다/g, name: '고려 (조언형/AI 냄새 - 금지!)', maxAllowed: 0 },
    
    // 🚨 추가 금지 표현 (의료광고법 + 네이버 로직)
    { pattern: /조기\s*발견/g, name: '조기 발견 (불안 조장 - 금지!)', maxAllowed: 0 },
    { pattern: /조기\s*치료/g, name: '조기 치료 (불안 조장 - 금지!)', maxAllowed: 0 },
    { pattern: /\d+주\s*(이상|이내|안에)/g, name: '구체적 시간 (2주 이상 등 - 금지!)', maxAllowed: 0 },
    { pattern: /\d+시간\s*(이내|안에)/g, name: '구체적 시간 (48시간 내 등 - 금지!)', maxAllowed: 0 },
    { pattern: /상담하세요|방문하세요|확인하세요/g, name: '행동 유도 (~하세요 - 금지!)', maxAllowed: 0 },
    { pattern: /하는\s*것이\s*좋습니다/g, name: '행동 유도 (~하는 것이 좋습니다 - 금지!)', maxAllowed: 0 },
    { pattern: /하면\s*좋다/g, name: '행동 유도 (~하면 좋다 - 금지!)', maxAllowed: 0 },
    { pattern: /\?/g, name: '질문형(?) 사용 (금지!)', maxAllowed: 0 },
    { pattern: /있으신가요|하신가요|아시나요|드시나요/g, name: '독자에게 말걸기 (금지!)', maxAllowed: 0 },
    { pattern: /질병관리청|보건복지부|대한[가-힣]+학회/g, name: '기관명 언급 (금지!)', maxAllowed: 0 },
    { pattern: /\d+%|\d+명|\d+건/g, name: '수치 표현 (%, 명, 건 - 금지!)', maxAllowed: 0 },
    
    // 🚨 만연체/긴 문장 감지 (호흡 늘어짐 방지)
    { pattern: /[가-힣],\s*[가-힣]+,\s*[가-힣]+,/g, name: '쉼표 3개 이상 (문장 나누기 필요)', maxAllowed: 2 },
    { pattern: /하고,?\s*[가-힣]+하며,?\s*[가-힣]+해서/g, name: '~하고 ~하며 ~해서 (만연체 - 끊어쓰기!)' },
    { pattern: /으로\s*인해.*으로\s*인해/g, name: '~으로 인해 반복 (만연체)' },
    
    // 🎯 과도한 비유 감지
    { pattern: /마치.*처럼|마치.*같이/g, name: '마치~처럼 비유', maxAllowed: 2 },
    { pattern: /[가-힣]+은\s*[가-힣]+과\s*같아서/g, name: '~은 ~과 같아서 비유', maxAllowed: 1 },
    
    // 🚨 명사형 종결어미 과다 (동사형 권장)
    { pattern: /의\s*[가-힣]+입니다/g, name: '명사형 종결어미 (의 ~입니다) - 동사형 권장', maxAllowed: 2 },
    { pattern: /[이가]\s*[가-힣]+입니다(?![가-힣])/g, name: '명사형 종결어미 (이/가 ~입니다) - 동사형 권장', maxAllowed: 3 },
  ];

  const detected: string[] = [];
  let totalMatches = 0;

  for (const item of aiPatterns) {
    const { pattern, name } = item;
    const maxAllowed = item.maxAllowed ?? 0;
    const matches = text.match(pattern);
    if (matches && matches.length > maxAllowed) {
      detected.push(`${name} (${matches.length}회, 허용: ${maxAllowed}회)`);
      totalMatches += matches.length - maxAllowed;
    }
  }

  // 점수 계산 (텍스트 길이 대비)
  const textLength = text.length;
  const score = Math.min(100, Math.round((totalMatches / textLength) * 1000));

  return {
    detected: detected.length > 0,
    patterns: detected,
    score
  };
}
