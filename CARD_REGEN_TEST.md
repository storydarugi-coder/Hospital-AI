# 카드뉴스 이미지 재생성 기능 테스트 가이드

## ✅ 기능 상태: 정상 작동

카드뉴스 이미지 재생성 기능이 완벽하게 구현되어 있습니다.

## 📋 테스트 방법

### 1단계: 카드뉴스 생성
1. Hospital AI 앱 실행
2. "콘텐츠 타입" → "카드뉴스" 선택
3. 진료과 및 주제 입력
4. "병원 블로그 원고 생성" 클릭
5. 카드뉴스 원고 승인 → 이미지 생성 완료까지 대기

### 2단계: 재생성 버튼 확인
재생성 버튼은 3곳에서 접근 가능:

#### 방법 1: 카드 오버레이 (추천)
- 각 카드 위에 마우스 오버
- "🔄 재생성" 버튼 클릭

#### 방법 2: 다운로드 모달
- "💾 다운로드" 버튼 클릭
- 개별 카드의 "🔄" 버튼 클릭

#### 방법 3: 결과 화면 직접 클릭
- 카드 이미지 직접 클릭
- 오버레이 메뉴에서 재생성 선택

### 3단계: 재생성 모달 사용
재생성 모달이 열리면:

#### 기본 옵션:
- **부제목 (Subtitle)**: 카드 상단 작은 텍스트
- **메인 타이틀 (Main Title)**: 카드 중앙 큰 제목
- **설명 (Description)**: 카드 하단 설명 텍스트
- **이미지 프롬프트**: 자동 생성됨 (수동 수정 가능)

#### 고급 옵션:
1. **AI 프롬프트 추천** 버튼
   - AI가 개선된 프롬프트 제안
   - 한 번 클릭으로 자동 적용

2. **프롬프트 저장/불러오기**
   - "💾 이 프롬프트 저장" 버튼
   - 최근 3개 히스토리 저장
   - 드롭다운에서 이전 프롬프트 재사용

3. **참고 이미지 업로드**
   - 이미지 파일 선택
   - **완전 복제**: 레이아웃+색상 동일하게
   - **복제+색상변경**: 레이아웃만 복제, 색상은 변경
   - **고정**: 여러 카드에 동일 스타일 적용

### 4단계: 재생성 실행
- "🎨 이 카드 재생성" 버튼 클릭
- 생성 진행 상황 확인
- 완료 시 자동으로 카드 이미지 교체

## 🔧 주요 기능

### ✨ 스타일 유지
- 커스텀 스타일 프롬프트는 재생성 시에도 유지
- 실사/3D일러스트/의학3D 스타일 선택 유지

### 📝 프롬프트 자동 연동
- 텍스트 변경 시 이미지 프롬프트 자동 업데이트
- AI 추천 프롬프트 적용 시 자동 연동 일시 중지

### 🖼️ 참고 이미지
- **완전 복제 모드**: 참고 이미지의 레이아웃과 색상을 그대로 복제
- **복제+색상변경**: 레이아웃만 복제, 색상은 새로운 테마로
- **이미지 고정**: 여러 카드에 동일한 참고 이미지 적용

### 💾 히스토리 관리
- 최근 사용한 프롬프트 3개 자동 저장
- localStorage에 영구 저장
- 언제든지 불러와서 재사용 가능

## ⚠️ 예상되는 문제 및 해결

### 문제 1: 버튼이 안 보임
**원인**: 마우스 오버가 안 됨
**해결**: 
- 카드 위에 마우스를 올려보세요
- 또는 "💾 다운로드" 버튼 → 개별 카드의 "🔄" 클릭

### 문제 2: "프롬프트를 수정하거나 참고 이미지를 업로드해주세요" 경고
**원인**: 아무것도 수정하지 않음
**해결**: 
- 텍스트(부제목/메인타이틀/설명) 중 하나라도 수정
- 또는 이미지 프롬프트 수정
- 또는 참고 이미지 업로드

### 문제 3: 이미지 생성 실패
**원인**: API 할당량 초과 또는 네트워크 오류
**해결**: 
- 잠시 후 다시 시도
- API 키 확인 (설정 → API 키)
- 프롬프트를 더 간단하게 수정

### 문제 4: 스타일이 바뀜
**원인**: 커스텀 스타일이 초기화됨
**해결**: 
- 이 문제는 수정되었습니다
- `savedCustomStylePrompt` 변수로 스타일 유지
- 재생성 시에도 동일한 스타일 적용됨

## 🎨 활용 팁

### Tip 1: 일관된 스타일 유지
1. 첫 번째 카드 재생성 시 참고 이미지 업로드
2. "🔒 이 참고 이미지 고정" 체크
3. 나머지 카드들도 동일한 참고 이미지로 재생성
4. 결과: 모든 카드가 통일된 스타일

### Tip 2: AI 프롬프트 추천 활용
1. 재생성 모달 열기
2. "✨ AI 프롬프트 추천" 버튼 클릭
3. AI가 제안한 프롬프트 확인
4. 마음에 들면 "🎨 이 카드 재생성" 바로 클릭

### Tip 3: 프롬프트 재사용
1. 마음에 드는 카드 재생성 후
2. "💾 이 프롬프트 저장" 클릭
3. 다음 카드 재생성 시
4. 히스토리 드롭다운에서 불러오기

### Tip 4: 빠른 수정
1. 부제목/메인타이틀만 살짝 수정
2. 이미지 프롬프트는 자동 연동됨
3. 바로 재생성 버튼 클릭
4. 빠르게 변형 생성

## 📊 성능 정보

- **재생성 시간**: 약 10-30초 (API 속도에 따라 다름)
- **히스토리 저장**: 최근 3개 (localStorage)
- **참고 이미지**: Base64 인코딩 (최대 5MB 권장)
- **동시 재생성**: 1개씩 순차 처리

## 🔍 디버깅

콘솔에서 다음 로그 확인:
```
🔄 카드 재생성 파라미터: { style, customStylePrompt, hasRefImage, ... }
🎨 재생성 시 커스텀 스타일: ...
✅ [n]번 카드가 재생성되었습니다!
```

문제 발생 시 브라우저 콘솔(F12)을 열어 에러 메시지 확인.

---

**결론**: 카드뉴스 이미지 재생성 기능은 **정상적으로 작동**합니다. 위 테스트 방법대로 실행하면 문제없이 사용 가능합니다.
